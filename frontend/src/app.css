@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
    :root {
        --color-primary: #000000;
        --color-primary-rgb: 0 0 0;
        --color-secondary: #141414;
        --color-secondary-rgb: 20 20 20;
        --color-tertiary: #2d2d2d;
        --color-tertiary-rgb: 45 45 45;
        --color-accent: #450292;
        --color-accent-rgb: 69 2 146;
        --color-accent-hover: #5809b5;
        --color-accent-hover-rgb: 88 9 181;
        --color-text-primary: #f9fafb;
        --color-text-primary-rgb: 249 250 251;
        --color-text-secondary: #a1a1aa;
        --color-text-secondary-rgb: 161 161 170;
    }

    .theme-light {
        --color-primary: #fff4e6;
        --color-primary-rgb: 255 244 230;
        --color-secondary: #ffe9d2;
        --color-secondary-rgb: 255 233 210;
        --color-tertiary: #e8d4bf;
        --color-tertiary-rgb: 232 212 191;
        --color-accent: #c45f0a;
        --color-accent-rgb: 196 95 10;
        --color-accent-hover: #d26e1a;
        --color-accent-hover-rgb: 210 110 26;
        --color-text-primary: #2d2018;
        --color-text-primary-rgb: 45 32 24;
        --color-text-secondary: #5a4432;
        --color-text-secondary-rgb: 90 68 50;
    }
	html,
	body {
		@apply text-text-primary antialiased font-sans overflow-x-hidden;
		background-color: rgb(var(--color-primary-rgb));
	}
	::-webkit-scrollbar {
		@apply w-2 h-2;
	}
	::-webkit-scrollbar-track {
		@apply bg-tertiary/50;
	}
	::-webkit-scrollbar-thumb {
		@apply bg-accent rounded-full;
	}
	::-webkit-scrollbar-thumb:hover {
		@apply bg-accent-hover;
	}

    :root {
        scrollbar-color: var(--color-accent) color-mix(in oklab, var(--color-tertiary) 85%, #000 15%);
        scrollbar-width: thin;
    }
    .theme-light {
        scrollbar-color: var(--color-accent) color-mix(in oklab, var(--color-tertiary) 70%, #fff 30%);
    }
    .theme-light ::-webkit-scrollbar-track {
        background-color: rgb(var(--color-tertiary-rgb) / 0.55);
    }
    .theme-light ::-webkit-scrollbar-thumb {
        background-color: rgb(var(--color-accent-rgb));
    }

    .prose {
        font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif !important;
        font-weight: 500 !important;
        line-height: 1.65 !important;
        letter-spacing: 0.005em;
    }
	.prose p {
		@apply my-2;
	}

	.prose h1,
	.prose h2,
	.prose h3,
	.prose h4,
	.prose h5,
	.prose h6 {
		color: rgb(var(--color-text-primary-rgb)) !important;
	}

	.prose :where(code):not(:where(pre *)) {
		@apply font-mono font-medium text-text-secondary px-1.5 py-0.5 bg-tertiary/70 rounded-md;
	}
	.theme-light .prose :where(code):not(:where(pre *)) {
		color: #3b2a1f;
		background-color: rgba(232, 212, 191, 0.8);
		border: 1px solid rgba(90, 68, 50, 0.25);
	}

    .prose .code-wrapper {
        @apply my-4 relative;
        border-radius: 12px;
        overflow: hidden;
        background: linear-gradient(145deg, #0d1117 0%, #161b22 100%);
        border: 1px solid rgba(var(--color-accent-rgb), 0.2);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        position: relative;
    }

    .prose .code-wrapper pre {
        @apply p-0 m-0 font-mono relative;
        background: transparent !important;
        font-weight: 500 !important;
        font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', Consolas, 'Liberation Mono', Menlo, monospace !important;
        font-size: 14px !important;
        line-height: 1.6 !important;
        border: none;
        border-radius: 0;
        padding: 20px !important;
        position: relative;
        overflow-x: auto;
        scrollbar-width: thin;
        scrollbar-color: rgba(var(--color-accent-rgb), 0.3) rgba(255, 255, 255, 0.05);
        color: #e6edf3 !important;
    }

    .prose .code-wrapper pre::-webkit-scrollbar {
        height: 8px;
    }

    .prose .code-wrapper pre::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
    }

    .prose .code-wrapper pre::-webkit-scrollbar-thumb {
        background: rgba(var(--color-accent-rgb), 0.4);
        border-radius: 4px;
    }

    .theme-light .prose .code-wrapper {
        background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
        border: 1px solid rgba(var(--color-accent-rgb), 0.15);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .theme-light .prose .code-wrapper pre {
        color: #24292f !important;
        scrollbar-color: rgba(var(--color-accent-rgb), 0.4) rgba(0, 0, 0, 0.05);
    }

    .theme-light .prose .code-wrapper pre::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
    }

    .theme-light .prose .code-wrapper pre::-webkit-scrollbar-thumb {
        background: rgba(var(--color-accent-rgb), 0.3);
    }
	.hljs-number,
	.hljs-variable,
	.hljs-template-variable { color: #79c0ff; }
	.hljs-string,
	.hljs-attr,
	.hljs-attribute { color: #a5d6ff; }
	.hljs-title,
	.hljs-section,
	.hljs-name,
	.hljs-selector-id,
	.hljs-selector-class { color: #d2a8ff; font-weight: 600; }
	.hljs-meta,
	.hljs-symbol,
	.hljs-bullet { color: #ffa657; }
	.hljs-emphasis { font-style: italic; }
	.hljs-strong { font-weight: 600; }
	.hljs-addition { color: #aff5b4; background-color: rgba(46, 160, 67, 0.15); }
	.hljs-deletion { color: #ffdcd7; background-color: rgba(248, 81, 73, 0.15); }

	.theme-light .hljs { color: #24292f; background: transparent; }
	.theme-light .hljs-comment,
	.theme-light .hljs-quote { color: #6e7781; font-style: italic; }
	.theme-light .hljs-keyword,
	.theme-light .hljs-selector-tag,
	.theme-light .hljs-literal { color: #cf222e; font-weight: 600; }
	.theme-light .hljs-type,
	.theme-light .hljs-built_in,
	.theme-light .hljs-number,
	.theme-light .hljs-variable,
	.theme-light .hljs-template-variable { color: #0550ae; }
	.theme-light .hljs-string,
	.theme-light .hljs-attr,
	.theme-light .hljs-attribute { color: #0a3069; }
	.theme-light .hljs-title,
	.theme-light .hljs-section,
	.theme-light .hljs-name,
	.theme-light .hljs-selector-id,
	.theme-light .hljs-selector-class { color: #8250df; font-weight: 600; }
	.theme-light .hljs-meta,
	.theme-light .hljs-symbol,
	.theme-light .hljs-bullet { color: #bc4c00; }
	.theme-light .hljs-emphasis { font-style: italic; }
	.theme-light .hljs-strong { font-weight: 600; }
	.theme-light .hljs-addition { color: #116329; background-color: rgba(17, 99, 41, 0.1); }
	.theme-light .hljs-deletion { color: #82071e; background-color: rgba(130, 7, 30, 0.1); }

	.prose .code-wrapper pre code.hljs {
		@apply block p-4 pt-8;
		white-space: pre-wrap;
		overflow-x: auto;
		word-wrap: break-word;
		line-height: 1.5;
		font-size: 0.875rem;
	}

	.prose *,
	.prose {
		min-width: 0;
	}
	.prose p,
	.prose li,
	.prose blockquote,
	.prose h1,
	.prose h2,
	.prose h3,
	.prose h4,
	.prose h5,
	.prose h6,
	.prose a {
		word-break: break-word;
		overflow-wrap: anywhere;
		hyphens: auto;
	}
	.prose :where(code):not(:where(pre *)) {
		word-break: break-word;
		overflow-wrap: anywhere;
	}
	.prose img,
	.prose video,
	.prose iframe {
		max-width: 100%;
		height: auto;
		display: inline-block;
	}

	@media (max-width: 640px) {
		.prose table,
		.prose pre,
		.prose .katex-display {
			max-width: 100%;
		}
	}

	.prose table,
	.prose pre,
	.prose .katex-display {
		@apply block max-w-full overflow-x-auto;
	}
}

@layer components {
    .animated-border-card {
        @apply relative rounded-2xl border border-tertiary bg-secondary/95 shadow-2xl shadow-black/40 overflow-hidden transition-all duration-300 ease-in-out;
    }
    .animated-border-card:hover {
        @apply transform -translate-y-1 shadow-2xl shadow-accent/20;
    }
    .animated-border-card::after {
        content: '';
        position: absolute;
        inset: -2px;
        border-radius: 1.25rem;
        background: conic-gradient(from 0deg,
            rgba(var(--color-accent-rgb) / 0.35),
            rgba(59 130 246 / 0.25),
            rgba(var(--color-accent-rgb) / 0.35));
        filter: blur(12px);
        z-index: -1;
        animation: gradient-spin 6s linear infinite;
        pointer-events: none;
        transition: all 0.3s ease-in-out;
    }
    .animated-border-card:hover::after {
        filter: blur(24px);
        opacity: 0.8;
    }
    .theme-light .animated-border-card {
        @apply bg-secondary/90 shadow-lg shadow-black/10;
    }
    .theme-light .animated-border-card:hover {
        @apply shadow-xl shadow-accent/20;
    }

    .bg-orb {
        @apply absolute inset-0;
        will-change: transform;
    }

    .bg-circle {
        @apply absolute w-[50vmax] h-[50vmax] rounded-full;
        background: radial-gradient(circle, #8a2be2 0%, #4b0082 35%, transparent 70%);
        filter: blur(100px);
        opacity: 0.3;
        animation-name: ambient-drift;
        animation-duration: var(--dur, 40s);
        animation-timing-function: ease-in-out;
        animation-iteration-count: infinite;
        transition:
            opacity 1.2s ease,
            filter 1.2s ease;
    }

    .bg-circle.secondary {
        background: radial-gradient(circle, #9370db 0%, #c71585 35%, transparent 70%);
        animation-name: ambient-drift-2;
        animation-duration: var(--dur, 45s);
        animation-direction: alternate;
    }

    .theme-light .bg-circle {
        background: radial-gradient(circle, rgba(252, 176, 64, 0.95) 0%, rgba(255, 145, 90, 0.8) 35%, transparent 70%);
        filter: blur(50px);
        opacity: 0.75;
    }
    .theme-light .bg-circle.secondary {
        background: radial-gradient(circle, rgba(255, 205, 120, 0.95) 0%, rgba(255, 175, 95, 0.8) 35%, transparent 70%);
    }

    .thinking .bg-circle {
        opacity: 0.5;
        filter: blur(70px);
    }
    .thinking .bg-circle.secondary {
        opacity: 0.46;
        filter: blur(80px);
    }

    .thinking .bg-orb {
        animation: jitter var(--jitter-duration, 7s) ease-in-out infinite alternate;
    }

	.input-container {
		@apply relative flex w-full rounded-2xl border border-tertiary bg-secondary shadow-2xl shadow-black/40 transition-all;
		@apply flex-col;
		min-height: 3.5rem;
		max-height: 50vh;
		overflow: visible;
	}
	.input-container .toolbar-row {
		@apply flex items-center justify-between w-full border-t border-tertiary/50 px-2 py-1 gap-2 flex-wrap;
	}
	.input-container textarea {
		@apply w-full bg-transparent p-4 resize-none outline-none placeholder-text-secondary max-h-52 overflow-y-auto;
	}
	.input-container .actions-left { @apply flex items-center gap-1; }
	.input-container .actions-right { @apply flex items-center gap-2; }
	.input-container .send-btn { @apply rounded-full w-10 h-10 flex items-center justify-center; }
	.input-container:focus-within {
		@apply border-accent/70;
		box-shadow: 0 0 0 4px rgb(var(--color-accent-rgb) / 0.25), 0 10px 30px -5px rgba(0, 0, 0, 0.5);
	}

	.auth-input-wrapper {
		@apply relative w-full;
	}
	.auth-input-icon {
		@apply absolute top-1/2 left-3 -translate-y-1/2 text-text-secondary transition-colors duration-300;
	}
	.auth-input {
		@apply w-full bg-primary/80 border-2 border-tertiary rounded-lg text-text-primary outline-none pl-10 pr-4 py-2.5 transition-all duration-300;
	}
	.auth-input:focus {
		@apply border-accent/80;
		box-shadow: inset 0 1px 2px rgb(var(--color-primary-rgb) / 0.5), 0 0 0 3px rgb(var(--color-accent-rgb) / 0.25);
	}
	.auth-input:focus + .auth-input-icon {
		@apply text-accent;
	}

    .btn-gradient {
        @apply bg-gradient-to-r from-accent to-accent-hover text-white font-semibold rounded-lg shadow-lg hover:shadow-xl hover:shadow-accent/40 transition-all duration-300 ease-in-out;
    }

    .loading-bubble-animation {
        @apply relative overflow-hidden;
        transition: all 0.35s ease;
        background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.05), rgba(var(--accent-rgb), 0.12), rgba(var(--accent-rgb), 0.05));
        background-size: 200% 200%;
        animation: subtle-glow 4s ease-in-out infinite;
    }

    .loading-bubble-animation::after {
        @apply absolute top-0 left-0 h-full w-4/5 content-[''] pointer-events-none;
        background: linear-gradient(90deg, 
            transparent 0%, 
            rgba(255, 255, 255, 0.15) 30%, 
            rgba(255, 255, 255, 0.3) 50%, 
            rgba(255, 255, 255, 0.15) 70%, 
            transparent 100%
        );
        transform: translateX(-150%) skewX(-20deg);
        animation: enhanced-shimmer 2.2s ease-in-out infinite;
        opacity: 0;
        border-radius: inherit;
        filter: blur(0.5px);
    }

    .theme-light .loading-bubble-animation::after {
        background: linear-gradient(90deg, 
            transparent 0%, 
            rgba(0, 0, 0, 0.1) 30%, 
            rgba(0, 0, 0, 0.2) 50%, 
            rgba(0, 0, 0, 0.1) 70%, 
            transparent 100%
        );
    }
    .loading-bubble-animation:not(.has-stream-text)::after {
        opacity: 1;
    }

    @keyframes enhanced-shimmer {
        0% {
            transform: translateX(-150%) skewX(-20deg);
        }
        100% {
            transform: translateX(280%) skewX(-20deg);
        }
    }

    @keyframes subtle-glow {
        0%, 100% {
            background-position: 0% 50%;
        }
        50% {
            background-position: 100% 50%;
        }
    }

    @media (prefers-reduced-motion: reduce) {
        .loading-bubble-animation::after {
            animation: none;
        }
        .loading-bubble-animation {
            animation: none;
        }
    }
    .thinking-elements {
        transition: opacity 0.35s ease, transform 0.35s ease;
    }

	.thinking-elements.fade-out {
		opacity: 0;
		transform: translateY(-5px);
	}
	
    .streaming-text {
		opacity: 0;
		transform: translateY(5px);
        animation: fade-in-up 0.35s ease-out forwards;
	}
	
	@keyframes fade-in-up {
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.code-footer {
		@apply flex items-center justify-between px-3 py-2 text-xs font-sans rounded-b-xl;
		background-color: #161b22;
	}
    .theme-light .code-footer {
        background-color: #e9ecef;
    }
	.theme-light .code-footer .footer-left { color: #495057; }
	.theme-light .code-footer .footer-left button { color: #495057; }
	.theme-light .code-footer .footer-left button:hover { background-color: #dee2e6; color: #212529; }
	.theme-light .code-footer .footer-right { color: #6c757d; }

	.theme-light .prose a {
		color: var(--color-accent);
		text-decoration: underline;
		text-decoration-color: rgb(var(--color-accent-rgb) / 0.4);
		transition: text-decoration-color 0.2s ease;
	}
	.theme-light .prose a:hover {
		text-decoration-color: rgb(var(--color-accent-rgb) / 0.8);
	}

	.theme-light .prose.prose-invert a {
		color: #fff;
		text-decoration-color: rgba(255, 255, 255, 0.5);
	}
	.theme-light .prose.prose-invert a:hover {
		text-decoration-color: rgba(255, 255, 255, 0.9);
	}
	.code-footer .footer-left {
		@apply flex items-center gap-3 text-text-secondary/80;
	}
	.code-footer .footer-left button {
		@apply flex items-center justify-center p-1.5 rounded-md text-text-secondary transition-colors hover:bg-tertiary/80 hover:text-text-primary;
	}
	.code-footer .footer-left button:disabled {
		@apply text-green-400;
	}
	.code-footer .footer-left button:disabled:hover {
		@apply bg-transparent;
	}
	.code-footer .footer-right {
		@apply font-semibold uppercase text-text-secondary/70;
	}

[data-sonner-toaster][data-theme='dark'] {
    --sonner-z-index: 60;
    --sonner-border-radius: 14px;
    --sonner-shadow: 0 14px 38px rgba(0, 0, 0, 0.55);
    --sonner-toast-background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--color-secondary) 90%, black 10%),
        color-mix(in oklab, var(--color-secondary) 85%, black 15%)
    );
    --sonner-toast-foreground: var(--color-text-primary);
}
[data-sonner-toaster] .sonner-toast {
    position: relative;
    border: 1px solid color-mix(in oklab, var(--color-tertiary) 70%, #000 30%);
    backdrop-filter: saturate(120%) blur(10px);
    overflow: hidden;
}
[data-sonner-toaster] .sonner-toast::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, rgba(147, 51, 234, 0.85), rgba(59, 130, 246, 0.65));
}
[data-sonner-toaster] .sonner-title {
    font-weight: 800;
    letter-spacing: 0.2px;
}
[data-sonner-toaster] .sonner-description {
    color: color-mix(in oklab, var(--color-text-secondary) 85%, #fff 15%);
}
[data-sonner-toaster] .sonner-icon {
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.45);
}
[data-sonner-toaster] .sonner-close-button {
    border-radius: 10px;
    transition: transform 0.2s ease, background-color 0.2s ease;
}
[data-sonner-toaster] .sonner-close-button:hover {
    transform: scale(1.05);
}
[data-sonner-toaster] .sonner-toast::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent);
}

.streaming-text {
	will-change: transform, opacity;
}
.danger-zone {
	@apply border border-red-700/50 bg-red-900/20;
}
.theme-light .danger-zone {
	@apply border-red-300 bg-red-50;
}
	.danger-zone-title { @apply text-red-200; }
	.theme-light .danger-zone-title { @apply text-red-800; }
	.danger-zone-desc { @apply text-text-secondary; }
	.danger-zone-btn { @apply bg-red-700 hover:bg-red-800 text-white; }
	.theme-light .danger-zone-btn { @apply bg-red-600 hover:bg-red-700 text-white; }
}

@keyframes ambient-drift {
	0% {
		transform: translate(0vw, 0vh) scale(1) rotate(0deg);
	}
	12.5% {
		transform: translate(5vw, -10vh) scale(1.1) rotate(-45deg);
	}
	25% {
		transform: translate(15vw, -8vh) scale(1) rotate(-90deg);
	}
	37.5% {
		transform: translate(8vw, 10vh) scale(1.2) rotate(-135deg);
	}
	50% {
		transform: translate(0vw, 15vh) scale(1) rotate(-180deg);
	}
	62.5% {
		transform: translate(-10vw, 8vh) scale(0.9) rotate(-225deg);
	}
	75% {
		transform: translate(-15vw, -5vh) scale(1.1) rotate(-270deg);
	}
	87.5% {
		transform: translate(-5vw, -12vh) scale(1) rotate(-315deg);
	}
	100% {
		transform: translate(0vw, 0vh) scale(1) rotate(-360deg);
	}
}

@keyframes ambient-drift-2 {
	0% {
		transform: translate(0vw, 0vh) scale(1) rotate(0deg);
	}
	25% {
		transform: translate(-12vw, 15vh) scale(1.15) rotate(90deg);
	}
	50% {
		transform: translate(10vw, -10vh) scale(0.9) rotate(180deg);
	}
	75% {
		transform: translate(5vw, 15vh) scale(1.1) rotate(270deg);
	}
	100% {
		transform: translate(0vw, 0vh) scale(1) rotate(360deg);
	}
}

@keyframes text-shine {
	0% {
		transform: translateX(-120%);
		opacity: 0;
	}
	15% {
		opacity: 1;
	}
	85% {
		opacity: 1;
	}
	100% {
		transform: translateX(120%);
		opacity: 0;
	}
}

@keyframes shine {
	0% {
		background-position: -200% center;
	}
	50% {
		background-position: 200% center;
	}
	100% {
		background-position: -200% center;
	}
}

.animate-text-shine {
	animation: text-shine 2s ease-in-out infinite;
}

.animate-shine {
	animation: shine 4s ease-in-out infinite;
	background-size: 200% auto;
}

.theme-light .animate-text-shine {
	background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.1), transparent);
}


@keyframes jitter {
    0%   { transform: translate(0vw, 0vh); }
    20%  { transform: translate(1.2vw, -0.8vh); }
    40%  { transform: translate(-1.5vw, 1.1vh); }
    60%  { transform: translate(1.0vw, 0.7vh); }
    80%  { transform: translate(-0.8vw, -1.0vh); }
    100% { transform: translate(0vw, 0vh); }
}

@keyframes loading-wipe {
	0% {
		transform: translateX(-150%);
	}
	100% {
		transform: translateX(450%);
	}
}

.chat-header {
  background-color: rgb(var(--color-primary-rgb) / 0.80);
  backdrop-filter: blur(12px);
}
.theme-light .chat-header {
  background-color: rgb(var(--color-secondary-rgb) / 0.70);
}